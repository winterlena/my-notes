<template>
  <nav>
    <!-- иконка для декстопного варианта, не зависимо от авторизации пользователя -->
    <svg v-if="!isMobile" width="219" height="50" viewBox="0 0 219 50" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M15.319 23.663a2 2 0 1 0 1.035 3.862l20.242-5.422a2 2 0 1 0-1.035-3.863zm.311 8.887a2 2 0 0 1 1.414-2.448l20.243-5.423a2 2 0 0 1 1.035 3.863L18.08 33.965a2 2 0 0 1-2.45-1.414m8.66 2.511a2 2 0 1 0 1.036 3.863l9.201-2.465a2 2 0 1 0-1.035-3.863z" fill="#B1C909"/>
      <path fill-rule="evenodd" clip-rule="evenodd" d="M46.068 9.608 26.728 0 5.93 5.57a8 8 0 0 0-5.656 9.796L7.968 44.07a8 8 0 0 0 9.798 5.655l28.71-7.69a8 8 0 0 0 5.657-9.796zM6.967 9.434 25.83 4.38l1.628 6.073a6 6 0 0 0 7.348 4.242l7.915-2.12 5.548 20.699a4 4 0 0 1-2.829 4.898l-28.71 7.69a4 4 0 0 1-4.9-2.827L4.138 14.331a4 4 0 0 1 2.829-4.897m23.53-3.096 7.024 3.49-3.749 1.004a2 2 0 0 1-2.45-1.414z" fill="#B1C909"/>
      <path d="M210.161 35.413q-2.145 0-4.192-.511-2.049-.544-3.264-1.344l1.664-3.583q1.152.735 2.784 1.215 1.631.448 3.2.448 3.168 0 3.168-1.567 0-.736-.864-1.056t-2.656-.544q-2.112-.32-3.488-.736a5.5 5.5 0 0 1-2.4-1.471q-.993-1.056-.992-3.008 0-1.63.928-2.879.96-1.28 2.752-1.983 1.824-.704 4.288-.704 1.824 0 3.616.416 1.823.384 3.008 1.087l-1.664 3.552q-2.272-1.28-4.96-1.28-1.6 0-2.4.448-.8.447-.8 1.151 0 .8.864 1.12t2.752.608q2.112.352 3.456.768a5.07 5.07 0 0 1 2.336 1.44q.992 1.055.992 2.943 0 1.599-.96 2.847t-2.816 1.952q-1.824.67-4.352.671m-17.308-3.999q1.344 0 2.368-.384a6 6 0 0 0 1.952-1.28l2.656 2.88q-2.432 2.784-7.104 2.783-2.912 0-5.152-1.12-2.24-1.15-3.456-3.167-1.216-2.015-1.216-4.574 0-2.528 1.184-4.543a8.4 8.4 0 0 1 3.296-3.167q2.112-1.152 4.736-1.152 2.464 0 4.48 1.056 2.016 1.023 3.2 3.007 1.216 1.95 1.216 4.639l-12.736 2.463q.544 1.28 1.696 1.92 1.184.64 2.88.64m-.736-9.95q-1.888 0-3.072 1.217-1.183 1.215-1.248 3.359l8.384-1.632q-.353-1.344-1.44-2.143-1.088-.8-2.624-.8m-10.224 12.86q-.737.544-1.824.831-1.056.256-2.208.256-3.105 0-4.768-1.567-1.664-1.567-1.664-4.607v-15.1h4.992v4.19h4.256v3.84h-4.256v7.006q0 1.087.544 1.695.543.576 1.568.576 1.151 0 2.048-.64zm-23.145 1.087q-2.72 0-4.896-1.12-2.143-1.15-3.36-3.167-1.216-2.015-1.216-4.574 0-2.56 1.216-4.575 1.217-2.016 3.36-3.135 2.177-1.152 4.896-1.152 2.72 0 4.864 1.152 2.143 1.119 3.36 3.135 1.216 2.015 1.216 4.575t-1.216 4.574q-1.217 2.016-3.36 3.168-2.144 1.12-4.864 1.12m0-4.095q1.92 0 3.136-1.28 1.248-1.311 1.248-3.486t-1.248-3.456q-1.216-1.311-3.136-1.311t-3.168 1.311q-1.248 1.28-1.248 3.456 0 2.175 1.248 3.487 1.248 1.28 3.168 1.28m-21.437-18.94q4 0 6.24 2.527 2.24 2.495 2.24 7.134v13.116h-5.184V22.201q0-2.688-1.28-4.031-1.248-1.376-3.488-1.376-2.368 0-3.808 1.472-1.407 1.44-1.408 4.287v12.604h-5.184V12.763h5.024v2.72a7.2 7.2 0 0 1 2.88-2.304q1.728-.8 3.968-.8m-16.848 5.567v14.332q0 4.736-2.4 7.038-2.4 2.304-6.976 2.304-2.433 0-4.608-.608-2.145-.608-3.616-1.76l1.984-3.583q1.087.897 2.656 1.408 1.568.512 3.168.512 2.496 0 3.648-1.152t1.152-3.519v-.576a6.5 6.5 0 0 1-2.272 1.472 7.7 7.7 0 0 1-2.816.512q-3.393 0-5.376-1.92-1.984-1.951-1.984-5.822v-8.638h4.992v7.902q0 4.19 3.488 4.19 1.791 0 2.88-1.151 1.088-1.184 1.088-3.487v-7.454zM89.976 12.38q3.968 0 6.176 2.335 2.208 2.303 2.208 6.686v13.756h-5.184V21.561q0-2.367-1.248-3.551-1.215-1.215-3.232-1.216-2.208 0-3.52 1.28-1.312 1.247-1.312 3.807v13.276H78.68V21.561q0-2.367-1.152-3.551-1.152-1.215-3.136-1.216-2.175 0-3.488 1.28-1.312 1.247-1.312 3.807v13.276h-5.184V12.763h5.024v2.751a6.66 6.66 0 0 1 2.72-2.303q1.695-.832 3.904-.832 2.304 0 4.032.864 1.728.832 2.656 2.431a7.3 7.3 0 0 1 3.008-2.431q1.889-.864 4.224-.864" fill="#B1C909"/>
    </svg>

    <!-- иконка для неавторизованных пользователей, мобильный вариант-->
    <svg v-else-if="isMobile && !isAuthenticated" width="154" height="36" viewBox="0 0 154 36" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M10.807 17.037c-.753.206-1.2.995-.998 1.763a1.41 1.41 0 0 0 1.728 1.018l14.281-3.904c.753-.206 1.2-.995.998-1.763a1.41 1.41 0 0 0-1.728-1.018zm.22 6.4c-.202-.768.245-1.558.998-1.764l14.28-3.904a1.41 1.41 0 0 1 1.729 1.018c.201.768-.245 1.558-.998 1.763l-14.281 3.904a1.41 1.41 0 0 1-1.728-1.017m6.11 1.808c-.753.206-1.2.995-.998 1.763a1.41 1.41 0 0 0 1.728 1.018l6.492-1.775c.752-.206 1.199-.995.997-1.763a1.41 1.41 0 0 0-1.728-1.018z" fill="#B1C909"/>
      <path fill-rule="evenodd" clip-rule="evenodd" d="M32.5 6.918 18.856 0 4.185 4.011c-3.011.823-4.798 3.98-3.991 7.053L5.62 31.73c.807 3.071 3.902 4.895 6.912 4.071l20.256-5.537c3.01-.823 4.797-3.981 3.99-7.053zM4.915 6.792l13.309-3.638 1.148 4.372c.605 2.304 2.926 3.672 5.184 3.054l5.584-1.526 3.914 14.903c.403 1.536-.49 3.115-1.996 3.527L11.803 33.02c-1.505.412-3.053-.5-3.456-2.036L2.92 10.32c-.404-1.536.49-3.115 1.995-3.527m16.6-2.229 4.956 2.513-2.645.723a1.41 1.41 0 0 1-1.728-1.018z" fill="#B1C909"/>
      <path d="M148.266 25.498q-1.513 0-2.958-.369-1.444-.392-2.302-.967l1.174-2.58q.812.53 1.964.875 1.151.323 2.257.323 2.235 0 2.235-1.13 0-.529-.609-.76-.61-.23-1.874-.39-1.49-.231-2.461-.53a3.9 3.9 0 0 1-1.693-1.06q-.7-.76-.7-2.165 0-1.176.655-2.073.677-.921 1.941-1.429 1.287-.506 3.025-.506 1.287 0 2.552.3 1.286.275 2.122.782l-1.174 2.557a6.9 6.9 0 0 0-3.5-.921q-1.128 0-1.693.322-.564.323-.564.83 0 .575.609.806.61.23 1.942.437 1.49.254 2.438.553.949.276 1.648 1.037.7.76.7 2.119 0 1.151-.677 2.05-.678.898-1.987 1.405-1.287.483-3.07.484m-12.21-2.88q.948 0 1.67-.276a4.2 4.2 0 0 0 1.377-.921l1.874 2.073q-1.715 2.004-5.012 2.004-2.054 0-3.634-.807-1.581-.828-2.439-2.28-.857-1.45-.857-3.294 0-1.82.835-3.27a6 6 0 0 1 2.325-2.281q1.49-.83 3.341-.83 1.739 0 3.161.76a5.5 5.5 0 0 1 2.257 2.166q.858 1.405.858 3.34l-8.985 1.774q.384.921 1.197 1.382.835.46 2.032.46m-.52-7.163q-1.332 0-2.167.875-.835.876-.88 2.419l5.914-1.175a2.7 2.7 0 0 0-1.015-1.543q-.768-.576-1.852-.576m-7.213 9.259q-.519.392-1.287.6a6.5 6.5 0 0 1-1.557.184q-2.19 0-3.364-1.13-1.174-1.127-1.174-3.316V10.18h3.522v3.017h3.002v2.765h-3.002v5.044q0 .783.384 1.22.383.415 1.106.415.813 0 1.445-.46zm-16.328.784q-1.919 0-3.454-.807a6.1 6.1 0 0 1-2.371-2.28q-.858-1.45-.858-3.294 0-1.842.858-3.294a5.95 5.95 0 0 1 2.371-2.257q1.535-.83 3.454-.83t3.431.83a5.95 5.95 0 0 1 2.371 2.257q.858 1.452.858 3.294 0 1.844-.858 3.294a6.1 6.1 0 0 1-2.371 2.28q-1.512.807-3.431.807m0-2.949q1.354 0 2.212-.921.88-.945.881-2.51 0-1.567-.881-2.488-.858-.945-2.212-.945t-2.235.944q-.88.922-.881 2.488 0 1.566.881 2.51.88.922 2.235.922M96.872 8.913q2.82 0 4.402 1.82 1.58 1.796 1.58 5.136v9.444h-3.657v-9.328q0-1.935-.903-2.903-.88-.99-2.461-.99-1.672 0-2.686 1.06-.994 1.036-.994 3.086v9.075h-3.657V9.19h3.544v1.958a5.1 5.1 0 0 1 2.032-1.658q1.22-.576 2.8-.576m-11.887 4.007v10.32q0 3.408-1.693 5.067-1.694 1.658-4.922 1.658-1.716 0-3.25-.437-1.514-.439-2.552-1.267l1.4-2.58q.767.645 1.874 1.013a7 7 0 0 0 2.235.369q1.761 0 2.573-.83.813-.828.813-2.533v-.415q-.677.691-1.603 1.06a5.3 5.3 0 0 1-1.986.368q-2.394 0-3.793-1.382-1.4-1.404-1.4-4.192v-6.219h3.522v5.69q0 3.017 2.46 3.017 1.265 0 2.032-.83.768-.85.768-2.51V12.92zM63.477 8.913q2.8 0 4.357 1.681 1.558 1.658 1.558 4.815v9.904h-3.657v-9.79q0-1.704-.88-2.556-.86-.875-2.281-.875-1.557 0-2.483.921-.926.899-.926 2.741v9.56h-3.657v-9.79q0-1.704-.813-2.557-.814-.875-2.212-.875-1.536 0-2.461.921-.926.899-.926 2.741v9.56H45.44V9.188h3.544v1.981a4.7 4.7 0 0 1 1.92-1.658q1.196-.6 2.754-.599 1.625 0 2.844.622 1.22.6 1.874 1.75a5.2 5.2 0 0 1 2.122-1.75q1.332-.622 2.98-.622" fill="#B1C909"/>
    </svg>

    <!-- иконка для авторизованных пользователей, мобильный вариант -->
    <svg v-else-if="isMobile && isAuthenticated" width="37" height="36" viewBox="0 0 37 36" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M10.807 17.037c-.753.206-1.2.995-.998 1.763a1.41 1.41 0 0 0 1.728 1.018l14.281-3.904c.753-.206 1.2-.995.998-1.763a1.41 1.41 0 0 0-1.728-1.018zm.22 6.4c-.202-.768.245-1.558.998-1.764l14.28-3.904a1.41 1.41 0 0 1 1.729 1.018c.201.768-.245 1.558-.998 1.763l-14.281 3.904a1.41 1.41 0 0 1-1.728-1.017m6.11 1.808c-.753.206-1.2.995-.998 1.763a1.41 1.41 0 0 0 1.728 1.018l6.492-1.775c.752-.206 1.199-.995.997-1.763a1.41 1.41 0 0 0-1.728-1.018z" fill="#B1C909"/>
      <path fill-rule="evenodd" clip-rule="evenodd" d="M32.5 6.918 18.856 0 4.185 4.011c-3.011.823-4.798 3.98-3.991 7.053L5.62 31.73c.807 3.071 3.902 4.895 6.912 4.071l20.256-5.537c3.01-.823 4.797-3.981 3.99-7.053zM4.915 6.792l13.309-3.638 1.148 4.372c.605 2.304 2.926 3.672 5.184 3.054l5.584-1.526 3.914 14.903c.403 1.536-.49 3.115-1.996 3.527L11.803 33.02c-1.505.412-3.053-.5-3.456-2.036L2.92 10.32c-.404-1.536.49-3.115 1.995-3.527m16.6-2.229 4.956 2.513-2.645.723a1.41 1.41 0 0 1-1.728-1.018z" fill="#B1C909"/>
    </svg>

    <div v-if="isAuthenticated" class="user-info">
      <span class="user-email">{{ userEmail }}</span>
      <button @click="logout" @mouseenter="showTooltip = true" @mouseleave="showTooltip = false" class="button-exit">
        <!--иконка на кнопке ВЫХОД декстопный вариант-->
        <svg v-if="!isMobile" width="22" height="28" viewBox="0 0 22 28" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="11" cy="6" r="5" stroke="#fff" stroke-width="2"/>
          <path d="M21 28v-8a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v8" stroke="#fff" stroke-width="2"/>
        </svg>
        <!--иконка на кнопке ВЫХОД мобильный вариант-->
        <svg v-if="isMobile" width="16" height="18" viewBox="0 0 16 18" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="8" cy="3.857" r="2.857" stroke="#fff" stroke-width="2"/>
          <path d="M14.428 18v-3.714a4 4 0 0 0-4-4H5.571a4 4 0 0 0-4 4V18" stroke="#fff" stroke-width="2"/>
        </svg>
      </button>
      <!-- Всплывающее окно-подсказка -->
      <div v-if="showTooltip" class="tooltip">Выйти</div>

    </div>
    <button v-else @click="showAuthModal">
      <!--иконка на кнопке ВХОД-->
      <svg width="34" height="34" viewBox="0 0 34 34" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M6.308 4.545a1 1 0 1 0 1.384 1.443zm1.384 23.467a1 1 0 0 0-1.384 1.443zM1 16a1 1 0 1 0 0 2zm22 1 .707.707a1 1 0 0 0 0-1.414zm-6.707 5.293a1 1 0 0 0 1.414 1.414zm1.414-12a1 1 0 1 0-1.414 1.414zM32 17c0 8.316-6.513 15-14.477 15v2C26.653 34 34 26.357 34 17zM17.523 2C25.487 2 32 8.684 32 17h2c0-9.357-7.346-17-16.477-17zm-9.83 3.988C10.277 3.508 13.731 2 17.522 2V0C13.187 0 9.245 1.729 6.308 4.545zM17.522 32c-3.791 0-7.245-1.509-9.83-3.988l-1.385 1.443C9.245 32.271 13.187 34 17.523 34zM1 18h22v-2H1zm21.293-1.707-6 6 1.414 1.414 6-6zm1.414 0-6-6-1.414 1.414 6 6z" fill="#fff"/>
      </svg>
      Вход
    </button>
  </nav>
  <AuthModal v-if="isAuthModalVisible" @close="closeAuthModal" />
</template>

<script setup lang="ts">
import { ref, computed, onMounted, onUnmounted } from 'vue';
import { useAuthStore } from '@/store/authStore';
import AuthModal from '@/components/AuthModal.vue';

const authStore = useAuthStore();
const isAuthModalVisible = ref(false);

// Получаем состояние авторизации и email пользователя
const isAuthenticated = computed(() => authStore.isAuthenticated);
const userEmail = computed(() => authStore.userEmail);

const isMobile = ref(window.innerWidth <= 360);
const showTooltip = ref(false);

const showAuthModal = () => {
  isAuthModalVisible.value = true;
};

const closeAuthModal = () => {
  isAuthModalVisible.value = false;
};

const logout = async () => {
  await authStore.logout();
};

const handleResize = () => {
  isMobile.value = window.innerWidth <= 360;
};

onMounted(() => {
  window.addEventListener('resize', handleResize);
});

onUnmounted(() => {
  window.removeEventListener('resize', handleResize);
});
</script>

<style scoped>
nav {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 43px 0;
}

.tooltip {
  position: absolute;
  bottom: -250%;
  left: 65%;
  transform: translateX(-50%);
  background-color: var(--dark-middle-color);
  color: var(--green-light-color);
  padding: 40px;
  font-size: 18px;
  font-weight: 700;
  border-radius: 12px;
  z-index: 10;
  transition: opacity 0.2s;
  box-shadow: 0px 15px 46px -10px rgba(0, 0, 0, 0.6);
}

.tooltip:after {
  content: '';
  position: absolute;
  bottom: 100%;
  left: 60%;
  margin-left: 0;
  border-width: 9px;
  border-style: solid;
  border-color: transparent transparent var(--dark-middle-color) transparent;
}

.user-info {
  display: flex;
  align-items: center;
  gap: 12px;
  position: relative;
}

.user-email {
  color: var(--text-white-color);
  font-size: 18px;
}

.button-exit {
  background-color: var(--dark-middle-color);
  padding: 14px 18px;
}

button {
  display: inline-flex;
  align-items: center;
  gap: 17px;
}

/* Адаптивные стили */
@media (max-width: 1367px) {
  nav {
    padding: 23px 0;
  }
}

@media (max-width: 769px) {
  nav {
    padding: 23px 0;
  }
}

@media (max-width: 361px) {
  nav {
    padding: 20px 0;
  }

  .user-email {
    font-size: 14px;
  }

  .button-exit {
    padding: 9px 11px;
  }
}
</style>